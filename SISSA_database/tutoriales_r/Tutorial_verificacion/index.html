

<!DOCTYPE html>
<html class="writer-html5" lang="es">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pronósticos &mdash; documentación de Documentación - </title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js?v=653e5397"></script>
      <script src="../../../_static/doctools.js?v=888ff710"></script>
      <script src="../../../_static/sphinx_highlight.js?v=4825356b"></script>
      <script src="../../../_static/translations.js?v=efdbd0b9"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Índice" href="../../../genindex/" />
    <link rel="search" title="Búsqueda" href="../../../search/" />
    <link rel="next" title="Weather Generator" href="../../../weather_generator/" />
    <link rel="prev" title="Pronostico probabilistico para lluvia acumulada semanal" href="../Tutorial_pronostico_semana2/" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../" class="icon icon-home">
            Documentación
              <img src="../../../_static/crc_sas_logo.jpg" class="logo" alt="Logotipo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search/" method="get">
    <input type="text" name="q" placeholder="Buscar documentos" aria-label="Buscar documentos" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contenido:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../">SISSA Database</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../0Informacion_general/">Información general</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../1Descripcion_modelos/">Descripción de los modelos utilizados para generar la base</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../2Formato_de_datos/">Formato de datos</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../3Estructura_de_datos/">Estructura general de la base de datos pronosticados</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../4Metodologia_correccion/">Metodología de corrección</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../5Acceso_datos/">Acceso a los datos</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../6Tutoriales/">Tutoriales</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../6Tutoriales_python/">Tutoriales python</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../../6Tutoriales_R/">Tutoriales R</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="../Tutorial_descarga_datos/">¿Cómo descargar datos desde la base usando R?</a></li>
<li class="toctree-l4"><a class="reference internal" href="../Tutorial_online_plot/">¿Cómo trabajar con el archivo en línea?</a></li>
<li class="toctree-l4"><a class="reference internal" href="../Tutorial_online_lista_archivos/">¿Cómo trabajar con multiples archivos en línea usando R?</a></li>
<li class="toctree-l4"><a class="reference internal" href="../Tutorial_pronostico_semana2/">Pronostico probabilistico para lluvia acumulada semanal</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#"><strong>Pronósticos</strong></a></li>
<li class="toctree-l4"><a class="reference internal" href="#era5"><strong>ERA5</strong></a></li>
<li class="toctree-l4"><a class="reference internal" href="#verificacion-temporal"><strong>Verificación temporal</strong></a></li>
<li class="toctree-l4"><a class="reference internal" href="#verificacion-espacial"><strong>Verificación espacial</strong></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../weather_generator/">Weather Generator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../web_service_python/">Web Service python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../web_service_r/">Web Service R</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Preguntas_frecuentes/">Preguntas frecuentes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Novedades/">Novedades</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Suscripcion_a_novedades/">Suscripción a novedades</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Contacto/">Contacto</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../English_version/">English version</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../">Documentación</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../">SISSA Database</a></li>
          <li class="breadcrumb-item"><a href="../../6Tutoriales/">Tutoriales</a></li>
          <li class="breadcrumb-item"><a href="../../6Tutoriales_R/">Tutoriales R</a></li>
      <li class="breadcrumb-item active"><strong>Pronósticos</strong></li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/SISSA_database/tutoriales_r/Tutorial_verificacion.md.txt" rel="nofollow"> Ver código fuente de la página</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <p>En este tutorial vamos a realizar una verificación temporal y espacial del pronóstico corregido y sin corregir de las primeras semanas del mes de marzo. Vamos a utilizar la metodología que utiliza el SMN para la verificación, pero para el dominio del sudeste de Sudamérica. Para ello, vamos a:</p>
<ul class="simple">
<li><p>Elegir el dominio reducido.</p></li>
<li><p>Tomar los datos diarios de precipitación correspondientes a las semanas 1 de pronóstico del mes de marzo y calcular el acumulado.</p></li>
<li><p>Tomar los datos diarios del ERA5 para las mismas semanas y calcular el acumulado.</p></li>
<li><p>Elegir dos umbrales de precipitación (5 y 30 mm, usados por el SMN) y calcular los elementos de una tabla de contingencia y los ínidices Bias frec (Bias en la frecuencia), POD (Probabilidad de detección) y ETS (Equitable Threat Score):</p></li>
<li><p>Graficar los resultados de una verificación temporal y espacial.</p></li>
</ul>
<p>Vamos a estudiar este comportamiento para el mes de diciembre. Entonces, vamos a tomar <em>todos</em> los pronósticos inicializados en ese mes.</p>
<p>Además de la librería para conectar con AWS, vamos a necesitar para este tutorial tener instalado las siguientes librerías:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://cran.r-project.org/web/packages/ncdf4/ncdf4.pdf"><strong>ncdf4</strong></a></p></li>
<li><p><a class="reference external" href="https://cran.r-project.org/web/packages/raster/raster.pdf"><strong>raster</strong></a></p></li>
<li><p><a class="reference external" href="https://cran.r-project.org/web/packages/maps/maps.pdf"><strong>maps</strong></a></p></li>
<li><p><a class="reference external" href="https://cran.r-project.org/web/packages/colorRamps/colorRamps.pdf"><strong>colorRamps</strong></a></p></li>
<li><p><a class="reference external" href="https://cran.r-project.org/web/packages/dplyr/dplyr.pdf"><strong>dplyr</strong></a></p></li>
<li><p><a class="reference external" href="https://cran.r-project.org/web/packages/lubridate/lubridate.pdf"><strong>lubridate</strong></a></p></li>
</ul>
<p>Recordar que la estructura de datos del siguiente <a class="reference external" href="https://fmcarrasco.github.io/documentation_crc_sas/SISSA_database/2Estructura_de_datos/">link</a>.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Comenzamos instalando las librerías necesarias, en caso de que no lo estén: </span>
<span class="nf">if </span><span class="p">(</span><span class="o">!</span><span class="nf">requireNamespace</span><span class="p">(</span><span class="s">&quot;aws.s3&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">quietly</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="nf">install.packages</span><span class="p">(</span><span class="s">&quot;aws.s3&quot;</span><span class="p">)}</span>
<span class="nf">if </span><span class="p">(</span><span class="o">!</span><span class="nf">requireNamespace</span><span class="p">(</span><span class="s">&quot;ncdf4&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">quietly</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="nf">install.packages</span><span class="p">(</span><span class="s">&quot;ncdf4&quot;</span><span class="p">)}</span>
<span class="nf">if </span><span class="p">(</span><span class="o">!</span><span class="nf">requireNamespace</span><span class="p">(</span><span class="s">&quot;raster&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">quietly</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="nf">install.packages</span><span class="p">(</span><span class="s">&quot;raster&quot;</span><span class="p">)}</span>
<span class="nf">if </span><span class="p">(</span><span class="o">!</span><span class="nf">requireNamespace</span><span class="p">(</span><span class="s">&quot;maps&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">quietly</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="nf">install.packages</span><span class="p">(</span><span class="s">&quot;maps&quot;</span><span class="p">)}</span>
<span class="nf">if </span><span class="p">(</span><span class="o">!</span><span class="nf">requireNamespace</span><span class="p">(</span><span class="s">&quot;colorRamps&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">quietly</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="nf">install.packages</span><span class="p">(</span><span class="s">&quot;colorRamps&quot;</span><span class="p">)}</span>
<span class="nf">if </span><span class="p">(</span><span class="o">!</span><span class="nf">requireNamespace</span><span class="p">(</span><span class="s">&quot;dplyr&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">quietly</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="nf">install.packages</span><span class="p">(</span><span class="s">&quot;dplyr&quot;</span><span class="p">)}</span>
<span class="nf">if </span><span class="p">(</span><span class="o">!</span><span class="nf">requireNamespace</span><span class="p">(</span><span class="s">&quot;lubridate&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">quietly</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="nf">install.packages</span><span class="p">(</span><span class="s">&quot;lubridate&quot;</span><span class="p">)}</span>

<span class="c1"># Cargamos las librerías: </span>
<span class="nf">library</span><span class="p">(</span><span class="n">aws.s3</span><span class="p">)</span><span class="w">  </span>
<span class="nf">library</span><span class="p">(</span><span class="n">ncdf4</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">raster</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">maps</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">colorRamps</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">lubridate</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span>
<span class="nf">require</span><span class="p">(</span><span class="n">here</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Definimos algunos parámetros: </span>
<span class="n">variable</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">&quot;rain&quot;</span>
<span class="n">mes</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">3</span>
<span class="n">lat_n</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">-20</span>
<span class="n">lat_s</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">-30</span>
<span class="n">lon_w</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">-65</span>
<span class="n">lon_e</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">-55</span>

<span class="n">BUCKET_NAME</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">&quot;sissa-forecast-database&quot;</span>
</pre></div>
</div>
<section id="pronosticos">
<h1><strong>Pronósticos</strong><a class="headerlink" href="#pronosticos" title="Enlace permanente a este encabezado"></a></h1>
<p>Como la estructura de los datos de los modelos de pronóstico (corregido y sin corregir) es igual, vamos a usar un «for» para cargarlos, sin necesidad de descargar los archivos del AWS. Vamos a generar 2 archivos «.csv» con la información de las primeras semanas de pronóstico, sólo si estos no fueron generados previamente.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">tforecast</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">&quot;subseasonal&quot;</span>
<span class="n">modelos_gefs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;GEFSv12_corr&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;GEFSv12&quot;</span><span class="p">)</span>

<span class="c1"># Como el &quot;GEFSv12_corr&quot; y el &quot;GEFSv12&quot; tienen la misma estructura de datos, vamos a utilizar un ciclo &quot;for&quot;:</span>
<span class="nf">for </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="nf">seq_along</span><span class="p">(</span><span class="n">modelos_gefs</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span>
<span class="w">  </span><span class="n">archivo_gefs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">paste0</span><span class="p">(</span><span class="n">modelos_gefs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">variable</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="m">2010</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="m">2019</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;mes&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">mes</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;dom&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">lon_e</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">lon_w</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">lat_n</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">lat_s</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;.csv&quot;</span><span class="p">)</span>
<span class="w">  </span>
<span class="w">  </span><span class="c1"># Se corre esta parte del código sólo si el archivo no fue generado previamente: </span>
<span class="w">  </span><span class="nf">if </span><span class="p">(</span><span class="o">!</span><span class="nf">file.exists</span><span class="p">(</span><span class="n">archivo_gefs</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span>
<span class="w">    </span><span class="n">df_total</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">data.frame</span><span class="p">()</span>
<span class="w">    </span>
<span class="w">    </span><span class="nf">for </span><span class="p">(</span><span class="n">j</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="m">2010</span><span class="o">:</span><span class="m">2019</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1"># Loop sobre los años.</span>
<span class="w">      </span>
<span class="w">      </span><span class="c1"># Definimos el path:</span>
<span class="w">      </span><span class="n">PATH0</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">paste0</span><span class="p">(</span><span class="n">tforecast</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;/&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">modelos_gefs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="s">&quot;/&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">variable</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;/&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;/&quot;</span><span class="p">)</span>
<span class="w">          </span>
<span class="w">      </span><span class="c1"># Listamos todass las carpetas del año y mes del bucket:</span>
<span class="w">      </span><span class="n">awsfolders</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">get_bucket_df</span><span class="p">(</span>
<span class="w">        </span><span class="n">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BUCKET_NAME</span><span class="p">,</span>
<span class="w">        </span><span class="n">prefix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">paste0</span><span class="p">(</span><span class="n">PATH0</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="nf">sprintf</span><span class="p">(</span><span class="s">&quot;%02d&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">mes</span><span class="p">)),</span>
<span class="w">        </span><span class="n">max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">Inf</span><span class="p">,</span>
<span class="w">        </span><span class="n">region</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;us-west-2&quot;</span><span class="p">)</span>
<span class="w">      </span><span class="n">awsfolders</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">awsfolders</span><span class="o">$</span><span class="n">Key</span>
<span class="w">          </span>
<span class="w">      </span><span class="c1"># Separamos a &quot;awsfolder&quot; en función de las fechas de inicializaciones: </span>
<span class="w">      </span><span class="n">awsfolders_inic</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">unique</span><span class="p">(</span><span class="nf">dirname</span><span class="p">(</span><span class="n">awsfolders</span><span class="p">))</span>
<span class="w">      </span><span class="n">fechas_inic</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">basename</span><span class="p">(</span><span class="n">awsfolders_inic</span><span class="p">)</span><span class="w"> </span><span class="c1"># Fechas de inicializaciones.</span>
<span class="w">    </span>
<span class="w">      </span><span class="nf">for </span><span class="p">(</span><span class="n">k</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="nf">seq_along</span><span class="p">(</span><span class="n">awsfolders_inic</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span>
<span class="w">        </span><span class="n">fecha_inic</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">fechas_inic</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
<span class="w">            </span>
<span class="w">        </span><span class="nf">print</span><span class="p">(</span><span class="s">&quot;Extrayendo datos de los archivos inicializados en:&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="nf">print</span><span class="p">(</span><span class="n">fecha_inic</span><span class="p">)</span>
<span class="w">              </span>
<span class="w">        </span><span class="c1"># Nos quedamos sólo con los archivos correspondientes a esa fecha de inicialización: </span>
<span class="w">        </span><span class="n">awsfiles</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">grep</span><span class="p">(</span><span class="n">fecha_inic</span><span class="p">,</span><span class="w"> </span><span class="n">awsfolders</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span>
<span class="w">        </span><span class="c1"># Nos quedamos solo con la corrida control (por cuestiones de tiempo). </span>
<span class="w">        </span><span class="n">awsfiles</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">grep</span><span class="p">(</span><span class="s">&quot;c00&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">awsfiles</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> </span><span class="c1"># Comentarear esta línea en caso de querer hacerlo para todos los miembros del ensamble. </span>
<span class="w">    </span>
<span class="w">        </span><span class="nf">for </span><span class="p">(</span><span class="n">l</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="nf">seq_along</span><span class="p">(</span><span class="n">awsfiles</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span>
<span class="w">          </span><span class="nf">print</span><span class="p">(</span><span class="s">&quot;Extrayendo datos del archivo:&quot;</span><span class="p">)</span>
<span class="w">          </span><span class="nf">print</span><span class="p">(</span><span class="n">awsfiles</span><span class="p">[</span><span class="n">l</span><span class="p">])</span>
<span class="w">              </span>
<span class="w">          </span><span class="n">gefs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">s3read_using</span><span class="p">(</span><span class="n">FUN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ncdf4</span><span class="o">::</span><span class="n">nc_open</span><span class="p">,</span>
<span class="w">                               </span><span class="n">object</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">awsfiles</span><span class="p">[</span><span class="n">l</span><span class="p">],</span><span class="w"> </span>
<span class="w">                               </span><span class="n">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BUCKET_NAME</span><span class="p">,</span>
<span class="w">                               </span><span class="n">opts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">region</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;us-west-2&quot;</span><span class="p">))</span>
<span class="w">          </span>
<span class="w">          </span><span class="c1"># Leemos  las coordenadas:</span>
<span class="w">          </span><span class="c1"># var &lt;- ncvar_get(gefs, varid = variable)</span>
<span class="w">          </span><span class="n">lon</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">ncvar_get</span><span class="p">(</span><span class="n">gefs</span><span class="p">,</span><span class="w"> </span><span class="n">varid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;lon&quot;</span><span class="p">)</span><span class="w"> </span>
<span class="w">          </span><span class="n">lat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">ncvar_get</span><span class="p">(</span><span class="n">gefs</span><span class="p">,</span><span class="w"> </span><span class="n">varid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;lat&quot;</span><span class="p">)</span>
<span class="w">          </span><span class="n">time</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">ncvar_get</span><span class="p">(</span><span class="n">gefs</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;time&quot;</span><span class="p">)</span>
<span class="w">          </span><span class="n">time_units</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">ncatt_get</span><span class="p">(</span><span class="n">gefs</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;time&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;units&quot;</span><span class="p">)[[</span><span class="s">&quot;value&quot;</span><span class="p">]]</span>
<span class="w">          </span><span class="n">fecha_referencia</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.Date</span><span class="p">(</span><span class="nf">gsub</span><span class="p">(</span><span class="s">&quot;days since &quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">time_units</span><span class="p">))</span>
<span class="w">          </span><span class="c1"># Convertimos el tiempo a formato de días desde la fecha de referencia:</span>
<span class="w">          </span><span class="n">fechas</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">fecha_referencia</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
<span class="w">              </span>
<span class="w">          </span><span class="c1"># Vemos la posición del dominio en las longitudes y latitudes de los datos:</span>
<span class="w">          </span><span class="n">lon_idx</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">which</span><span class="p">(</span><span class="n">lon</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">lon_w</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">lon</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">lon_e</span><span class="p">)</span>
<span class="w">          </span><span class="n">lat_idx</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">which</span><span class="p">(</span><span class="n">lat</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">lat_s</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">lat</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">lat_n</span><span class="p">)</span>
<span class="w">          </span><span class="n">lon_rec</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lon</span><span class="p">[</span><span class="n">lon_idx</span><span class="p">]</span>
<span class="w">          </span><span class="n">lat_rec</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lat</span><span class="p">[</span><span class="n">lat_idx</span><span class="p">]</span>
<span class="w">          </span>
<span class="w">          </span><span class="c1"># Hacemos una selección de los datos en el dominio de interés y en la primer semana, y ahí extraemos los datos. Esta es la forma más eficiente de hacerlo:  </span>
<span class="w">          </span><span class="n">var_rec</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">ncvar_get</span><span class="p">(</span><span class="n">gefs</span><span class="p">,</span><span class="w"> </span><span class="n">varid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">variable</span><span class="p">,</span><span class="w"> </span>
<span class="w">                               </span><span class="n">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">lon_idx</span><span class="p">[</span><span class="m">1</span><span class="p">],</span><span class="w"> </span><span class="n">lat_idx</span><span class="p">[</span><span class="m">1</span><span class="p">],</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w"> </span>
<span class="w">                               </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="n">lon_idx</span><span class="p">),</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">lat_idx</span><span class="p">),</span><span class="w"> </span><span class="m">7</span><span class="p">))</span>
<span class="w">          </span><span class="nf">dim</span><span class="p">(</span><span class="n">var_rec</span><span class="p">)</span><span class="w"> </span><span class="c1"># Dimensiones: lon, lat, time.</span>
<span class="w">      </span>
<span class="w">          </span><span class="c1"># Calculamos el acumulado pronósticado de la primer semana: </span>
<span class="w">          </span><span class="n">suma</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="n">var_rec</span><span class="p">[,,</span><span class="m">1</span><span class="o">:</span><span class="m">7</span><span class="p">],</span><span class="w"> </span><span class="n">MARGIN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">),</span><span class="w"> </span><span class="n">FUN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sum</span><span class="p">)</span>
<span class="w">          </span><span class="nf">dim</span><span class="p">(</span><span class="n">suma</span><span class="p">)</span>
<span class="w">            </span>
<span class="w">          </span><span class="nf">if </span><span class="p">(</span><span class="n">l</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1"># Creamos una matriz con NA para guardar la info de todos los archivos (todos los miembros del ensamble):</span>
<span class="w">            </span><span class="n">gvar</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">array</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="n">dim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="n">lon_rec</span><span class="p">),</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">lat_rec</span><span class="p">),</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">awsfiles</span><span class="p">)))</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">      </span>
<span class="w">          </span><span class="c1"># Guardamos el valor de la variable:</span>
<span class="w">          </span><span class="n">gvar</span><span class="p">[,,</span><span class="n">l</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">suma</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span>
<span class="w">        </span><span class="c1"># Calculamos la media del ensamble: </span>
<span class="w">        </span><span class="n">media</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="n">gvar</span><span class="p">,</span><span class="w"> </span><span class="n">MARGIN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">),</span><span class="w"> </span><span class="n">FUN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">)</span>
<span class="w">        </span><span class="nf">dim</span><span class="p">(</span><span class="n">media</span><span class="p">)</span>
<span class="w">        </span>
<span class="w">        </span><span class="c1"># Convertimos la matriz en un data.frame: </span>
<span class="w">        </span><span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">data.frame</span><span class="p">(</span><span class="n">lon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="n">lon_rec</span><span class="p">,</span><span class="w"> </span><span class="n">times</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">lat_rec</span><span class="p">)),</span>
<span class="w">                         </span><span class="n">lat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="n">lat_rec</span><span class="p">,</span><span class="w"> </span><span class="n">each</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">lon_rec</span><span class="p">)),</span>
<span class="w">                         </span><span class="n">acum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">array</span><span class="p">(</span><span class="n">media</span><span class="p">,</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">lon_rec</span><span class="p">)</span><span class="o">*</span><span class="nf">length</span><span class="p">(</span><span class="n">lat_rec</span><span class="p">)))</span>
<span class="w">        </span><span class="n">df</span><span class="o">$</span><span class="n">fecha_inic</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.Date</span><span class="p">(</span><span class="n">fecha_inic</span><span class="p">,</span><span class="w"> </span><span class="n">format</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;%Y%m%d&quot;</span><span class="p">)</span>
<span class="w">        </span>
<span class="w">        </span><span class="n">df_total</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">bind_rows</span><span class="p">(</span><span class="n">df_total</span><span class="p">,</span><span class="w"> </span><span class="n">df</span><span class="p">)</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1"># Guardamos la información en un archivo &quot;.csv&quot;:</span>
<span class="w">    </span><span class="nf">write.table</span><span class="p">(</span><span class="n">df_total</span><span class="p">,</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">archivo_gefs</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;;&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">quote</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span>
<span class="w">                </span><span class="n">col.names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">row.names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w">  </span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="nf">rm</span><span class="p">(</span><span class="n">df_total</span><span class="p">)</span>
<span class="w">  </span><span class="nf">rm</span><span class="p">(</span><span class="n">archivo_gefs</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Cargamos los archivos «.csv» generados.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">df_total_corr</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">read.table</span><span class="p">(</span><span class="nf">paste0</span><span class="p">(</span><span class="s">&quot;GEFSv12_corr&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">variable</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="m">2010</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="m">2019</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;mes&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">mes</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;dom&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">lon_e</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">lon_w</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">lat_n</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">lat_s</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;.csv&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">sep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;;&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">header</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span>
<span class="n">df_total_corr</span><span class="o">$</span><span class="n">fecha_inic</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.Date</span><span class="p">(</span><span class="n">df_total_corr</span><span class="o">$</span><span class="n">fecha_inic</span><span class="p">)</span>
<span class="n">df_total_sincorr</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">read.table</span><span class="p">(</span><span class="nf">paste0</span><span class="p">(</span><span class="s">&quot;GEFSv12&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">variable</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="m">2010</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="m">2019</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;mes&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">mes</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;dom&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">lon_e</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">lon_w</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">lat_n</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">lat_s</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;.csv&quot;</span><span class="p">),</span><span class="w">  </span><span class="n">sep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;;&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">header</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span>
<span class="n">df_total_sincorr</span><span class="o">$</span><span class="n">fecha_inic</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.Date</span><span class="p">(</span><span class="n">df_total_sincorr</span><span class="o">$</span><span class="n">fecha_inic</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="era5">
<h1><strong>ERA5</strong><a class="headerlink" href="#era5" title="Enlace permanente a este encabezado"></a></h1>
<p>Vamos a hacer un procedimiento análogo para los datos de ERA5. Vamos a generar un archivo «.csv» con la información de las mismas semanas, sólo si este no fue generado previamente.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">modelo</span><span class="w"> </span><span class="o">&lt;-</span><span class="w">  </span><span class="s">&quot;ERA5&quot;</span>

<span class="n">archivo_obs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">paste0</span><span class="p">(</span><span class="n">modelo</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">variable</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="m">2010</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="m">2019</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;mes&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">mes</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;dom&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">lon_e</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">lon_w</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">lat_n</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">lat_s</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;.csv&quot;</span><span class="p">)</span>

<span class="c1"># Me fijo si el archivo ya fue generado, para no tener que descargar los datos nuevamente. </span>
<span class="nf">if </span><span class="p">(</span><span class="o">!</span><span class="nf">file.exists</span><span class="p">(</span><span class="n">archivo_obs</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span>
<span class="w">  </span><span class="n">df_total</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">data.frame</span><span class="p">()</span>

<span class="w">  </span><span class="nf">for </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="m">2010</span><span class="o">:</span><span class="m">2019</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1"># Loop sobre los años.</span>
<span class="w">    </span>
<span class="w">    </span><span class="c1"># Definimos el path: </span>
<span class="w">    </span><span class="n">PATH0</span><span class="w"> </span><span class="o">&lt;-</span><span class="w">  </span><span class="nf">paste0</span><span class="p">(</span><span class="n">modelo</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;/&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">variable</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;/&quot;</span><span class="p">)</span><span class="w"> </span>
<span class="w">    </span><span class="n">awsfile</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">paste0</span><span class="p">(</span><span class="n">PATH0</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;.nc&quot;</span><span class="p">)</span>
<span class="w">    </span>
<span class="w">    </span><span class="nf">print</span><span class="p">(</span><span class="s">&quot;Extrayendo datos del archivo:&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nf">print</span><span class="p">(</span><span class="n">awsfile</span><span class="p">)</span>
<span class="w">            </span>
<span class="w">    </span><span class="n">era5</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">s3read_using</span><span class="p">(</span><span class="n">FUN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ncdf4</span><span class="o">::</span><span class="n">nc_open</span><span class="p">,</span>
<span class="w">                         </span><span class="n">object</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">awsfile</span><span class="p">,</span><span class="w"> </span>
<span class="w">                         </span><span class="n">bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BUCKET_NAME</span><span class="p">,</span>
<span class="w">                         </span><span class="n">opts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">region</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;us-west-2&quot;</span><span class="p">))</span>
<span class="w">    </span>
<span class="w">    </span><span class="c1"># Leemos  las coordenadas:</span>
<span class="w">    </span><span class="c1"># var &lt;- ncvar_get(era5, varid = variable)</span>
<span class="w">    </span><span class="n">lon</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">ncvar_get</span><span class="p">(</span><span class="n">era5</span><span class="p">,</span><span class="w"> </span><span class="n">varid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;longitude&quot;</span><span class="p">)</span><span class="w"> </span>
<span class="w">    </span><span class="n">lat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">ncvar_get</span><span class="p">(</span><span class="n">era5</span><span class="p">,</span><span class="w"> </span><span class="n">varid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;latitude&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">time</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">ncvar_get</span><span class="p">(</span><span class="n">era5</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;time&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">time_units</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">ncatt_get</span><span class="p">(</span><span class="n">era5</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;time&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;units&quot;</span><span class="p">)[[</span><span class="s">&quot;value&quot;</span><span class="p">]]</span>
<span class="w">    </span><span class="n">fecha_referencia</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.Date</span><span class="p">(</span><span class="nf">gsub</span><span class="p">(</span><span class="s">&quot;days since &quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">time_units</span><span class="p">))</span>
<span class="w">    </span><span class="c1"># Convertimos el tiempo a formato de días desde la fecha de referencia:</span>
<span class="w">    </span><span class="n">fechas</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">fecha_referencia</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
<span class="w">            </span>
<span class="w">    </span><span class="c1"># Vemos la posición del dominio en las longitudes y latitudes de los datos:</span>
<span class="w">    </span><span class="n">lon_idx</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">which</span><span class="p">(</span><span class="n">lon</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">lon_w</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">lon</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">lon_e</span><span class="p">)</span>
<span class="w">    </span><span class="n">lat_idx</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">which</span><span class="p">(</span><span class="n">lat</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">lat_s</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">lat</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">lat_n</span><span class="p">)</span>
<span class="w">    </span><span class="n">lon_rec</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lon</span><span class="p">[</span><span class="n">lon_idx</span><span class="p">]</span>
<span class="w">    </span><span class="n">lat_rec</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lat</span><span class="p">[</span><span class="n">lat_idx</span><span class="p">]</span>
<span class="w">  </span>
<span class="w">    </span><span class="c1"># Hacemos una selección de los datos en el dominio de interés, y ahí extraemos los datos:  </span>
<span class="w">    </span><span class="n">var_rec</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">ncvar_get</span><span class="p">(</span><span class="n">era5</span><span class="p">,</span><span class="w"> </span><span class="n">varid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">variable</span><span class="p">,</span><span class="w"> </span>
<span class="w">                         </span><span class="n">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">lon_idx</span><span class="p">[</span><span class="m">1</span><span class="p">],</span><span class="w"> </span><span class="n">lat_idx</span><span class="p">[</span><span class="m">1</span><span class="p">],</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w"> </span>
<span class="w">                         </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="n">lon_idx</span><span class="p">),</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">lat_idx</span><span class="p">),</span><span class="w"> </span><span class="m">-1</span><span class="p">))</span>
<span class="w">    </span><span class="nf">dim</span><span class="p">(</span><span class="n">var_rec</span><span class="p">)</span><span class="w"> </span><span class="c1"># Dimensiones: lon, lat, time.</span>
<span class="w">    </span>
<span class="w">    </span><span class="c1"># Vemos las fechas de inicializacion de &quot;df_total_corr&quot; para ese año: </span>
<span class="w">    </span><span class="n">fechas_inic</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">unique</span><span class="p">(</span><span class="n">df_total_corr</span><span class="o">$</span><span class="n">fecha_inic</span><span class="p">[</span><span class="nf">which</span><span class="p">(</span><span class="nf">year</span><span class="p">(</span><span class="n">df_total_corr</span><span class="o">$</span><span class="n">fecha_inic</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">i</span><span class="p">)])</span>
<span class="w">  </span>
<span class="w">    </span><span class="nf">for </span><span class="p">(</span><span class="n">j</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="nf">seq_along</span><span class="p">(</span><span class="n">fechas_inic</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span>
<span class="w">      </span><span class="n">aux_inic</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">which</span><span class="p">(</span><span class="n">fechas</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">fechas_inic</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
<span class="w">      </span>
<span class="w">      </span><span class="c1"># Hacemos el recorte desde la fecha de inicialización hasta la primer semana, sólo si el día final de la primer semana está incluido en el archivo (esto puede no pasar para el mes de diciembre):</span>
<span class="w">      </span><span class="c1"># Por ejemplo, puede pasar que la fecha de inicialización del pronóstico sea el 31-12-2010, por lo que no se va a poder calcular el acumulado semanal de la primer semana asociada a dicha fecha de inicialización.</span>
<span class="w">      </span>
<span class="w">      </span><span class="nf">if </span><span class="p">((</span><span class="n">aux_inic</span><span class="m">+6</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nf">dim</span><span class="p">(</span><span class="n">var_rec</span><span class="p">)[</span><span class="m">3</span><span class="p">])</span><span class="w"> </span><span class="p">{</span><span class="nf">next</span><span class="p">()}</span>
<span class="w">      </span>
<span class="w">      </span><span class="n">var_rec2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">var_rec</span><span class="p">[,,</span><span class="n">aux_inic</span><span class="o">:</span><span class="p">(</span><span class="n">aux_inic</span><span class="m">+6</span><span class="p">)]</span>
<span class="w">      </span>
<span class="w">      </span><span class="c1"># Calculamos el acumulado observado de la primer semana: </span>
<span class="w">      </span><span class="n">suma</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="n">var_rec2</span><span class="p">[,,</span><span class="m">1</span><span class="o">:</span><span class="m">7</span><span class="p">],</span><span class="w"> </span><span class="n">MARGIN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">),</span><span class="w"> </span><span class="n">FUN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sum</span><span class="p">)</span>
<span class="w">      </span><span class="nf">dim</span><span class="p">(</span><span class="n">suma</span><span class="p">)</span>
<span class="w">      </span>
<span class="w">      </span><span class="c1"># Convertimos la matriz en un df: </span>
<span class="w">      </span><span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">data.frame</span><span class="p">(</span><span class="n">lon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="n">lon_rec</span><span class="p">,</span><span class="w"> </span><span class="n">times</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">lat_rec</span><span class="p">)),</span>
<span class="w">                       </span><span class="n">lat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="n">lat_rec</span><span class="p">,</span><span class="w"> </span><span class="n">each</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">lon_rec</span><span class="p">)),</span>
<span class="w">                       </span><span class="n">acum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">array</span><span class="p">(</span><span class="n">suma</span><span class="p">,</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">lon_rec</span><span class="p">)</span><span class="o">*</span><span class="nf">length</span><span class="p">(</span><span class="n">lat_rec</span><span class="p">)))</span>
<span class="w">      </span><span class="n">df</span><span class="o">$</span><span class="n">fecha_inic</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">fechas_inic</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
<span class="w">      </span>
<span class="w">      </span><span class="n">df_total</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">bind_rows</span><span class="p">(</span><span class="n">df_total</span><span class="p">,</span><span class="w"> </span><span class="n">df</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="c1"># Guardamos la información en un archivo &quot;.csv&quot;:</span>
<span class="w">  </span><span class="nf">write.table</span><span class="p">(</span><span class="n">df_total</span><span class="p">,</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">archivo_obs</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;;&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">quote</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span>
<span class="w">              </span><span class="n">col.names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">row.names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w">  </span>
<span class="p">}</span>
<span class="nf">rm</span><span class="p">(</span><span class="n">df_total</span><span class="p">)</span>
<span class="nf">rm</span><span class="p">(</span><span class="n">archivo_obs</span><span class="p">)</span>
</pre></div>
</div>
<p>Cargamos  el archivo «.csv» generado:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">df_total_obs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">read.table</span><span class="p">(</span><span class="nf">paste0</span><span class="p">(</span><span class="n">modelo</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">variable</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="m">2010</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="m">2019</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;mes&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">mes</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;dom&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">lon_e</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">lon_w</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">lat_n</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">lat_s</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;.csv&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">sep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;;&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">header</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span>
<span class="n">df_total_obs</span><span class="o">$</span><span class="n">fecha_inic</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.Date</span><span class="p">(</span><span class="n">df_total_obs</span><span class="o">$</span><span class="n">fecha_inic</span><span class="p">)</span>
</pre></div>
</div>
<p>Juntamos en un único DataFrame la información pronosticada y del ERA5.</p>
<p>Definimos una función para calcular los elementos de una tabla de contingencia:</p>
<ul class="simple">
<li><p><em>Hits</em>: Cantidad de casos en los cuales la observación y el pronóstico superaron el umbral.</p></li>
<li><p><em>False Alarms</em>: Cantidad de casos en los cuales el pronóstico superó el umbral pero la observación no.</p></li>
<li><p><em>Missed events</em>: Cantidad de casos en los cuales la observación superó el umbral pero el pronóstico no.</p></li>
<li><p><em>Correct negatives</em>: Cantidad de casos en los cuales la observción ni el pronóstico superaron en umbral.</p></li>
</ul>
<p>También la función calcula los siguientes índices de verificación, a partir de estos elementos:</p>
<ul class="simple">
<li><p><strong>Bias en la frecuencia</strong>: Compara las frecuencias pronosticadas con las observadas.</p></li>
<li><p><strong>Probabilidad de detección (POD)</strong>: Indica la proporción de casos observados que sí fueron pronosticados.</p></li>
<li><p><strong>ETS o Equitable Threat Score</strong>: Mide la proporción de aciertos pero ajustado por la cantidad de aciertos que fueron aleatorios.</p></li>
</ul>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">funcion_tabla_cont</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function </span><span class="p">(</span><span class="n">observacion</span><span class="p">,</span><span class="w"> </span><span class="n">pronostico</span><span class="p">,</span><span class="w"> </span><span class="n">umbral</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1"># Creamos vectores lógicos para los valores que superan el umbral:</span>
<span class="w">  </span><span class="n">obs_sup_umbral</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">observacion</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">umbral</span>
<span class="w">  </span><span class="n">prono_sup_umbral</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">pronostico</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">umbral</span>
<span class="w">  </span>
<span class="w">  </span><span class="n">hits</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">obs_sup_umbral</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">prono_sup_umbral</span><span class="p">)</span>
<span class="w">  </span><span class="n">false_alarms</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="o">!</span><span class="n">obs_sup_umbral</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">prono_sup_umbral</span><span class="p">)</span>
<span class="w">  </span><span class="n">missed_events</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">obs_sup_umbral</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">prono_sup_umbral</span><span class="p">)</span>
<span class="w">  </span><span class="n">correct_negatives</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="o">!</span><span class="n">obs_sup_umbral</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">prono_sup_umbral</span><span class="p">)</span>
<span class="w">  </span>
<span class="w">  </span><span class="n">total_events_observed</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">hits</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">missed_events</span>
<span class="w">  </span><span class="n">total_non_events_observed</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">false_alarms</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">correct_negatives</span>
<span class="w">  </span><span class="n">total_events_forecast</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">hits</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">false_alarms</span>
<span class="w">  </span><span class="n">total_non_events_forecast</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">missed_events</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">correct_negatives</span>
<span class="w">  </span><span class="n">total</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">hits</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">false_alarms</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">missed_events</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">correct_negatives</span>
<span class="w">  </span>
<span class="w">  </span><span class="n">bias_frec</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">total_events_forecast</span><span class="o">/</span><span class="n">total_events_observed</span>
<span class="w">  </span><span class="n">pod</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">hits</span><span class="o">/</span><span class="n">total_events_observed</span>
<span class="w">  </span><span class="n">far</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">false_alarms</span><span class="o">/</span><span class="n">total_events_forecast</span>
<span class="w">  </span>
<span class="w">  </span><span class="n">random_hits</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p">(</span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">total_events_forecast</span><span class="p">)</span><span class="o">*</span><span class="n">total_events_observed</span><span class="p">)</span><span class="o">/</span><span class="n">total</span>
<span class="w">  </span><span class="n">ets</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p">(</span><span class="n">hits</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">random_hits</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">hits</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">false_alarms</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">missed_events</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">random_hits</span><span class="p">)</span><span class="w"> </span>
<span class="w">  </span>
<span class="w">  </span><span class="nf">return</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="n">hits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hits</span><span class="p">,</span><span class="w"> </span><span class="n">false_alarm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">false_alarms</span><span class="p">,</span><span class="w"> </span>
<span class="w">           </span><span class="n">missed_events</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">missed_events</span><span class="p">,</span><span class="w"> </span><span class="n">correct_negatives</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">correct_negatives</span><span class="p">,</span><span class="w"> </span>
<span class="w">           </span><span class="n">bias_frec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bias_frec</span><span class="p">,</span><span class="w"> </span><span class="n">pod</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pod</span><span class="p">,</span><span class="w"> </span><span class="n">far</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">far</span><span class="p">,</span><span class="w"> </span><span class="n">ets</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ets</span><span class="p">))</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="verificacion-temporal">
<h1><strong>Verificación temporal</strong><a class="headerlink" href="#verificacion-temporal" title="Enlace permanente a este encabezado"></a></h1>
<p>Calculamos los índices por año, considerando todo el dominio.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Definimos umbrales:</span>
<span class="n">umbrales</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">30</span><span class="p">)</span>

<span class="n">tabla_total_corr</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">data.frame</span><span class="p">()</span>
<span class="n">tabla_total_sincorr</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">data.frame</span><span class="p">()</span>

<span class="c1"># Iteramos sobre cada umbral y año:</span>
<span class="nf">for </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="nf">seq_along</span><span class="p">(</span><span class="n">umbrales</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span>
<span class="w">  </span><span class="nf">for </span><span class="p">(</span><span class="n">j</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="m">2010</span><span class="o">:</span><span class="m">2019</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span>
<span class="w">    </span><span class="n">df_anio</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df_total</span><span class="p">[</span><span class="nf">year</span><span class="p">(</span><span class="n">df_total</span><span class="o">$</span><span class="n">fecha_inic</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">j</span><span class="p">,]</span>
<span class="w">    </span>
<span class="w">    </span><span class="c1"># Calculamos la tabla de contingencia para el pronóstico corregido y sin corregir:</span>
<span class="w">    </span><span class="n">tabla_corr</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">funcion_tabla_cont</span><span class="p">(</span><span class="n">observacion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df_anio</span><span class="o">$</span><span class="n">acum</span><span class="p">,</span><span class="w"> </span><span class="n">pronostico</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df_anio</span><span class="o">$</span><span class="n">acum_corr</span><span class="p">,</span>
<span class="w">                                     </span><span class="n">umbral</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">umbrales</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<span class="w">    </span><span class="n">tabla_corr</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">cbind.data.frame</span><span class="p">(</span><span class="n">umbral</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">umbrales</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">anio</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="nf">t</span><span class="p">(</span><span class="n">tabla_corr</span><span class="p">))</span>
<span class="w">    </span><span class="n">tabla_total_corr</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">bind_rows</span><span class="p">(</span><span class="n">tabla_total_corr</span><span class="p">,</span><span class="w"> </span><span class="n">tabla_corr</span><span class="p">)</span>
<span class="w">    </span>
<span class="w">    </span><span class="n">tabla_sincorr</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">funcion_tabla_cont</span><span class="p">(</span><span class="n">observacion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df_anio</span><span class="o">$</span><span class="n">acum</span><span class="p">,</span><span class="w"> </span><span class="n">pronostico</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df_anio</span><span class="o">$</span><span class="n">acum_sincorr</span><span class="p">,</span><span class="w"> </span><span class="n">umbral</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">umbrales</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<span class="w">    </span><span class="n">tabla_sincorr</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">cbind.data.frame</span><span class="p">(</span><span class="n">umbral</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">umbrales</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">anio</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="nf">t</span><span class="p">(</span><span class="n">tabla_sincorr</span><span class="p">))</span>
<span class="w">    </span><span class="n">tabla_total_sincorr</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">bind_rows</span><span class="p">(</span><span class="n">tabla_total_sincorr</span><span class="p">,</span><span class="w"> </span><span class="n">tabla_sincorr</span><span class="p">)</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Graficamos las series temporales, sólo para el umbral de 30 mm.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Elegimos un umbral:</span>
<span class="n">umbral</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">30</span>
<span class="n">tabla_corr</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tabla_total_corr</span><span class="p">[</span><span class="n">tabla_total_corr</span><span class="o">$</span><span class="n">umbral</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">umbral</span><span class="p">,]</span>
<span class="n">tabla_sincorr</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tabla_total_sincorr</span><span class="p">[</span><span class="n">tabla_total_sincorr</span><span class="o">$</span><span class="n">umbral</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">umbral</span><span class="p">,]</span>

<span class="nf">jpeg</span><span class="p">(</span><span class="nf">paste0</span><span class="p">(</span><span class="s">&quot;serie_temporal_verif&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">variable</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="m">2010</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="m">2019</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;mes&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">mes</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;dom&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">lon_e</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">lon_w</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">lat_n</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">lat_s</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;.jpg&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1300</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">800</span><span class="p">,</span><span class="w"> </span><span class="n">units</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;px&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">130</span><span class="p">)</span>

<span class="p">{</span><span class="c1"># Bias_frec prono corregido: </span>
<span class="nf">plot</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tabla_corr</span><span class="o">$</span><span class="n">anio</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tabla_corr</span><span class="o">$</span><span class="n">bias_frec</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;red&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">pch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">19</span><span class="p">,</span><span class="w"> </span>
<span class="w">     </span><span class="n">xlim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">2010</span><span class="p">,</span><span class="w"> </span><span class="m">2019</span><span class="p">),</span><span class="w"> </span><span class="n">ylim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">-1</span><span class="p">,</span><span class="m">3</span><span class="p">),</span><span class="w"> </span>
<span class="w">     </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Anio&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;ylab&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Valores de índice&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">     </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">paste</span><span class="p">(</span><span class="s">&quot;Pronóstico de precipitación semanal &gt;&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">umbral</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;mm&quot;</span><span class="p">,</span><span class="s">&quot;\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;mes&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">mes</span><span class="p">,</span><span class="s">&quot;\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Semana 1.&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Desde 2010 hasta 2019.&quot;</span><span class="p">))</span>
<span class="nf">lines</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tabla_corr</span><span class="o">$</span><span class="n">anio</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tabla_corr</span><span class="o">$</span><span class="n">bias_frec</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;red&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1.5</span><span class="p">)</span><span class="w"> </span>
<span class="c1"># Bias_frec prono sin corregir: </span>
<span class="nf">points</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tabla_sincorr</span><span class="o">$</span><span class="n">anio</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tabla_sincorr</span><span class="o">$</span><span class="n">bias_frec</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;red&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">pch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">19</span><span class="p">)</span>
<span class="nf">lines</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tabla_corr</span><span class="o">$</span><span class="n">anio</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tabla_sincorr</span><span class="o">$</span><span class="n">bias_frec</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;red&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1.5</span><span class="p">,</span><span class="w"> </span><span class="n">lty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w"> </span>
<span class="c1"># POD prono corregido: </span>
<span class="nf">points</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tabla_corr</span><span class="o">$</span><span class="n">anio</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tabla_corr</span><span class="o">$</span><span class="n">pod</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;blue&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">pch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">19</span><span class="p">)</span><span class="w"> </span>
<span class="nf">lines</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tabla_corr</span><span class="o">$</span><span class="n">anio</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tabla_corr</span><span class="o">$</span><span class="n">pod</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;blue&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1.5</span><span class="p">)</span>
<span class="c1"># POD prono sin corregir: </span>
<span class="nf">points</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tabla_sincorr</span><span class="o">$</span><span class="n">anio</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tabla_sincorr</span><span class="o">$</span><span class="n">pod</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;blue&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">pch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">19</span><span class="p">)</span><span class="w"> </span>
<span class="nf">lines</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tabla_sincorr</span><span class="o">$</span><span class="n">anio</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tabla_sincorr</span><span class="o">$</span><span class="n">pod</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;blue&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1.5</span><span class="p">,</span><span class="w"> </span><span class="n">lty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span>
<span class="c1"># ETS prono corregido: </span>
<span class="nf">points</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tabla_corr</span><span class="o">$</span><span class="n">anio</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tabla_corr</span><span class="o">$</span><span class="n">ets</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;green&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">pch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">19</span><span class="p">)</span><span class="w"> </span>
<span class="nf">lines</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tabla_corr</span><span class="o">$</span><span class="n">anio</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tabla_corr</span><span class="o">$</span><span class="n">ets</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;green&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1.5</span><span class="p">)</span>
<span class="c1"># ETS prono sin corregir: </span>
<span class="nf">points</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tabla_sincorr</span><span class="o">$</span><span class="n">anio</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tabla_sincorr</span><span class="o">$</span><span class="n">ets</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;green&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">pch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">19</span><span class="p">)</span><span class="w"> </span>
<span class="nf">lines</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tabla_sincorr</span><span class="o">$</span><span class="n">anio</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tabla_sincorr</span><span class="o">$</span><span class="n">ets</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;green&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1.5</span><span class="p">,</span><span class="w"> </span><span class="n">lty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span>
<span class="nf">legend</span><span class="p">(</span><span class="s">&quot;topright&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">legend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;BIAS FREC&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;POD&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;ETS&quot;</span><span class="p">),</span><span class="w"> </span>
<span class="w">       </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Índices&quot;</span><span class="p">,</span>
<span class="w">       </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;red&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;blue&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;green&quot;</span><span class="p">),</span><span class="w"> </span>
<span class="w">       </span><span class="n">pch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">19</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1.5</span><span class="p">,</span><span class="w"> </span>
<span class="w">       </span><span class="n">cex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.8</span><span class="p">,</span>
<span class="w">       </span><span class="n">inset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0.01</span><span class="p">,</span><span class="w"> </span><span class="m">0.01</span><span class="p">))</span>
<span class="nf">legend</span><span class="p">(</span><span class="s">&quot;topleft&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">legend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;Corregido&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Sin corregir&quot;</span><span class="p">),</span><span class="w"> </span>
<span class="w">       </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Pronósticos&quot;</span><span class="p">,</span>
<span class="w">       </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;black&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">       </span><span class="n">pch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">19</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1.5</span><span class="p">,</span><span class="w"> </span><span class="n">lty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">),</span>
<span class="w">       </span><span class="n">cex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.8</span><span class="p">,</span>
<span class="w">       </span><span class="n">inset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0.01</span><span class="p">,</span><span class="w"> </span><span class="m">0.01</span><span class="p">))}</span>

<span class="nf">graphics.off</span><span class="p">()</span>

<span class="n">knitr</span><span class="o">::</span><span class="nf">include_graphics</span><span class="p">(</span><span class="nf">paste0</span><span class="p">(</span><span class="s">&quot;serie_temporal_verif&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">variable</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="m">2010</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="m">2019</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;mes&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">mes</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;dom&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">lon_e</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">lon_w</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">lat_n</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">lat_s</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;.jpg&quot;</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="verificacion-espacial">
<h1><strong>Verificación espacial</strong><a class="headerlink" href="#verificacion-espacial" title="Enlace permanente a este encabezado"></a></h1>
<p>Calculamos los índices por punto de retícula, considerando todos los años.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">umbrales</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">30</span><span class="p">)</span>

<span class="n">tabla_total_corr</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">data.frame</span><span class="p">()</span>
<span class="n">tabla_total_sincorr</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">data.frame</span><span class="p">()</span>

<span class="c1"># Iteramos sobre cada umbral y punto de retícula:</span>
<span class="nf">for </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="nf">seq_along</span><span class="p">(</span><span class="n">umbrales</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span>
<span class="w">  </span><span class="n">ptos_reticula</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">unique</span><span class="p">(</span><span class="n">df_total</span><span class="p">[,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;lon&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;lat&quot;</span><span class="p">)])</span>
<span class="w">  </span>
<span class="w">  </span><span class="nf">for </span><span class="p">(</span><span class="n">j</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="nf">nrow</span><span class="p">(</span><span class="n">ptos_reticula</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span>
<span class="w">    </span><span class="n">df_pto_reticula</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df_total</span><span class="p">[</span><span class="n">df_total</span><span class="o">$</span><span class="n">lon</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ptos_reticula</span><span class="o">$</span><span class="n">lon</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">df_total</span><span class="o">$</span><span class="n">lat</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ptos_reticula</span><span class="o">$</span><span class="n">lat</span><span class="p">[</span><span class="n">j</span><span class="p">],]</span>
<span class="w">    </span>
<span class="w">    </span><span class="n">tabla_corr</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">funcion_tabla_cont</span><span class="p">(</span><span class="n">observacion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df_pto_reticula</span><span class="o">$</span><span class="n">acum</span><span class="p">,</span><span class="w"> </span><span class="n">pronostico</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df_pto_reticula</span><span class="o">$</span><span class="n">acum_corr</span><span class="p">,</span><span class="w"> </span><span class="n">umbral</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">umbrales</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<span class="w">    </span><span class="n">tabla_corr</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">cbind.data.frame</span><span class="p">(</span><span class="n">umbral</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">umbrales</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">lon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ptos_reticula</span><span class="o">$</span><span class="n">lon</span><span class="p">[</span><span class="n">j</span><span class="p">],</span>
<span class="w">                                   </span><span class="n">lat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ptos_reticula</span><span class="o">$</span><span class="n">lat</span><span class="p">[</span><span class="n">j</span><span class="p">],</span><span class="w"> </span><span class="nf">t</span><span class="p">(</span><span class="n">tabla_corr</span><span class="p">))</span>
<span class="w">    </span><span class="n">tabla_total_corr</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">bind_rows</span><span class="p">(</span><span class="n">tabla_total_corr</span><span class="p">,</span><span class="w"> </span><span class="n">tabla_corr</span><span class="p">)</span>
<span class="w">    </span>
<span class="w">    </span><span class="n">tabla_sincorr</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">funcion_tabla_cont</span><span class="p">(</span><span class="n">observacion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df_pto_reticula</span><span class="o">$</span><span class="n">acum</span><span class="p">,</span><span class="w"> </span><span class="n">pronostico</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df_pto_reticula</span><span class="o">$</span><span class="n">acum_sincorr</span><span class="p">,</span><span class="w"> </span><span class="n">umbral</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">umbrales</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<span class="w">    </span><span class="n">tabla_sincorr</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">cbind.data.frame</span><span class="p">(</span><span class="n">umbral</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">umbrales</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">lon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ptos_reticula</span><span class="o">$</span><span class="n">lon</span><span class="p">[</span><span class="n">j</span><span class="p">],</span>
<span class="w">                                      </span><span class="n">lat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ptos_reticula</span><span class="o">$</span><span class="n">lat</span><span class="p">[</span><span class="n">j</span><span class="p">],</span><span class="w"> </span><span class="nf">t</span><span class="p">(</span><span class="n">tabla_sincorr</span><span class="p">))</span>
<span class="w">    </span><span class="n">tabla_total_sincorr</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">bind_rows</span><span class="p">(</span><span class="n">tabla_total_sincorr</span><span class="p">,</span><span class="w"> </span><span class="n">tabla_sincorr</span><span class="p">)</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Graficamos los campos espaciales, sólo para el umbral de 30 mm.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Elegimos un umbral:</span>
<span class="n">umbral</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">30</span>
<span class="n">tabla_corr</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tabla_total_corr</span><span class="p">[</span><span class="n">tabla_total_corr</span><span class="o">$</span><span class="n">umbral</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">umbral</span><span class="p">,]</span>
<span class="n">tabla_sincorr</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tabla_total_sincorr</span><span class="p">[</span><span class="n">tabla_total_sincorr</span><span class="o">$</span><span class="n">umbral</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">umbral</span><span class="p">,]</span>

<span class="n">rast_tabla_corr</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">rasterFromXYZ</span><span class="p">(</span><span class="n">tabla_corr</span><span class="p">[,</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;lon&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;lat&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;pod&quot;</span><span class="p">)],</span><span class="w"> </span><span class="n">crs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">CRS</span><span class="p">(</span><span class="s">&quot;+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs+ towgs84=0,0,0&quot;</span><span class="p">))</span>
<span class="n">rast_tabla_sincorr</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">rasterFromXYZ</span><span class="p">(</span><span class="n">tabla_sincorr</span><span class="p">[,</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;lon&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;lat&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;pod&quot;</span><span class="p">)],</span><span class="w"> </span><span class="n">crs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">CRS</span><span class="p">(</span><span class="s">&quot;+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs+ towgs84=0,0,0&quot;</span><span class="p">))</span>

<span class="c1"># Creamos una escala y leyenda de colores: </span>
<span class="n">rango</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="nf">min</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="n">tabla_corr</span><span class="o">$</span><span class="n">pod</span><span class="p">,</span><span class="w"> </span><span class="n">tabla_sincorr</span><span class="o">$</span><span class="n">pod</span><span class="p">),</span><span class="w"> </span><span class="n">na.rm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">),</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="n">tabla_corr</span><span class="o">$</span><span class="n">pod</span><span class="p">,</span><span class="w"> </span><span class="n">tabla_sincorr</span><span class="o">$</span><span class="n">pod</span><span class="p">),</span><span class="w"> </span><span class="n">na.rm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">))</span>

<span class="nf">jpeg</span><span class="p">(</span><span class="nf">paste0</span><span class="p">(</span><span class="s">&quot;pod&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">variable</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="m">2010</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="m">2019</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;mes&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">mes</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;dom&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">lon_e</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">lon_w</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">lat_n</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">lat_s</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;.jpg&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1700</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">850</span><span class="p">,</span><span class="w"> </span><span class="n">units</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;px&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">130</span><span class="p">)</span>

<span class="nf">par</span><span class="p">(</span><span class="n">mfrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">),</span><span class="w"> </span><span class="n">mai</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">))</span>
<span class="p">{</span><span class="nf">plot</span><span class="p">(</span><span class="n">rast_tabla_corr</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rev</span><span class="p">(</span><span class="nf">green2red</span><span class="p">(</span><span class="m">99</span><span class="p">)),</span><span class="w"> </span>
<span class="w">      </span><span class="n">breaks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">seq</span><span class="p">(</span><span class="n">rango</span><span class="p">[</span><span class="m">1</span><span class="p">],</span><span class="w"> </span><span class="n">rango</span><span class="p">[</span><span class="m">2</span><span class="p">],</span><span class="w"> </span><span class="n">length.out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">100</span><span class="p">),</span>
<span class="w">      </span><span class="n">xlim</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="nf">c</span><span class="p">(</span><span class="n">lon_w</span><span class="p">,</span><span class="w"> </span><span class="n">lon_e</span><span class="p">),</span><span class="w"> </span>
<span class="w">      </span><span class="n">ylim</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="nf">c</span><span class="p">(</span><span class="n">lat_s</span><span class="p">,</span><span class="w"> </span><span class="n">lat_n</span><span class="p">),</span>
<span class="w">      </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">paste</span><span class="p">(</span><span class="s">&quot;Pronóstico corregido de precipitación semanal &gt;&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">umbral</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;mm&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;mes&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">mes</span><span class="p">,</span><span class="s">&quot;\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Semana 1.&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Desde 2010 hasta 2019.&quot;</span><span class="p">),</span>
<span class="w">      </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Longitud&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Latitud&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">      </span><span class="n">asp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span>
<span class="w">      </span><span class="n">legend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span>
<span class="n">maps</span><span class="o">::</span><span class="nf">map</span><span class="p">(</span><span class="s">&quot;world&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="n">lwd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;black&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="n">xlim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">lon_w</span><span class="p">,</span><span class="w"> </span><span class="n">lon_e</span><span class="p">),</span><span class="w"> </span>
<span class="w">          </span><span class="n">ylim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">lat_s</span><span class="p">,</span><span class="w"> </span><span class="n">lat_n</span><span class="p">),</span><span class="w"> </span>
<span class="w">          </span><span class="n">add</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">rast_tabla_sincorr</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rev</span><span class="p">(</span><span class="nf">green2red</span><span class="p">(</span><span class="m">99</span><span class="p">)),</span><span class="w"> </span>
<span class="w">      </span><span class="n">breaks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">seq</span><span class="p">(</span><span class="n">rango</span><span class="p">[</span><span class="m">1</span><span class="p">],</span><span class="w"> </span><span class="n">rango</span><span class="p">[</span><span class="m">2</span><span class="p">],</span><span class="w"> </span><span class="n">length.out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">100</span><span class="p">),</span>
<span class="w">     </span><span class="n">xlim</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="nf">c</span><span class="p">(</span><span class="n">lon_w</span><span class="p">,</span><span class="w"> </span><span class="n">lon_e</span><span class="p">),</span><span class="w"> </span>
<span class="w">     </span><span class="n">ylim</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="nf">c</span><span class="p">(</span><span class="n">lat_s</span><span class="p">,</span><span class="w"> </span><span class="n">lat_n</span><span class="p">),</span>
<span class="w">     </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">paste</span><span class="p">(</span><span class="s">&quot;Pronóstico sin corregir de precipitación semanal &gt;&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">umbral</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;mm&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;mes&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">mes</span><span class="p">,</span><span class="s">&quot;\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Semana 1.&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Desde 2010 hasta 2019.&quot;</span><span class="p">),</span>
<span class="w">     </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Longitud&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Latitud&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">     </span><span class="n">asp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span>
<span class="w">     </span><span class="n">axis.args</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">at</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">seq</span><span class="p">(</span><span class="n">rango</span><span class="p">[</span><span class="m">1</span><span class="p">],</span><span class="w"> </span><span class="n">rango</span><span class="p">[</span><span class="m">2</span><span class="p">],</span><span class="w"> </span><span class="nf">abs</span><span class="p">(</span><span class="n">rango</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="o">-</span><span class="n">rango</span><span class="p">[</span><span class="m">2</span><span class="p">])</span><span class="o">/</span><span class="m">4</span><span class="p">),</span>
<span class="w">                      </span><span class="n">labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">round</span><span class="p">(</span><span class="nf">seq</span><span class="p">(</span><span class="n">rango</span><span class="p">[</span><span class="m">1</span><span class="p">],</span><span class="w"> </span><span class="n">rango</span><span class="p">[</span><span class="m">2</span><span class="p">],</span><span class="w"> </span><span class="nf">abs</span><span class="p">(</span><span class="n">rango</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="o">-</span><span class="n">rango</span><span class="p">[</span><span class="m">2</span><span class="p">])</span><span class="o">/</span><span class="m">4</span><span class="p">),</span><span class="w"> </span><span class="m">2</span><span class="p">),</span><span class="w"> </span><span class="n">cex.axis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">),</span>
<span class="w">     </span><span class="n">legend.args</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;POD&quot;</span><span class="p">))</span>
<span class="n">maps</span><span class="o">::</span><span class="nf">map</span><span class="p">(</span><span class="s">&quot;world&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="n">lwd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;black&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="n">xlim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">lon_w</span><span class="p">,</span><span class="w"> </span><span class="n">lon_e</span><span class="p">),</span><span class="w"> </span>
<span class="w">          </span><span class="n">ylim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">lat_s</span><span class="p">,</span><span class="w"> </span><span class="n">lat_n</span><span class="p">),</span><span class="w"> </span>
<span class="w">          </span><span class="n">add</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)}</span>
<span class="nf">graphics.off</span><span class="p">()</span>

<span class="n">knitr</span><span class="o">::</span><span class="nf">include_graphics</span><span class="p">(</span><span class="nf">paste0</span><span class="p">(</span><span class="s">&quot;pod&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">variable</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="m">2010</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="m">2019</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;mes&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">mes</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;dom&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">lon_e</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">lon_w</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">lat_n</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">lat_s</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;.jpg&quot;</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Pie de página">
        <a href="../Tutorial_pronostico_semana2/" class="btn btn-neutral float-left" title="Pronostico probabilistico para lluvia acumulada semanal" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Anterior</a>
        <a href="../../../weather_generator/" class="btn btn-neutral float-right" title="Weather Generator" accesskey="n" rel="next">Siguiente <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Derechos de autor Centro Regional sobre el clima para el Sur de América del Sur.</p>
  </div>

  Compilado con <a href="https://www.sphinx-doc.org/">Sphinx</a> usando un
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">tema</a>
    proporcionado por <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>